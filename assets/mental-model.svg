<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 920">
  <defs>
    <!-- Gradients -->
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#0F172A"/>
      <stop offset="100%" stop-color="#1E1B4B"/>
    </linearGradient>
    <linearGradient id="ventureGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#6366F1" stop-opacity="0.15"/>
      <stop offset="100%" stop-color="#6366F1" stop-opacity="0.05"/>
    </linearGradient>
    <linearGradient id="divisionGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#818CF8" stop-opacity="0.15"/>
      <stop offset="100%" stop-color="#818CF8" stop-opacity="0.05"/>
    </linearGradient>
    <linearGradient id="cmdGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#8B5CF6" stop-opacity="0.25"/>
      <stop offset="100%" stop-color="#8B5CF6" stop-opacity="0.08"/>
    </linearGradient>
    <linearGradient id="prjGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#10B981" stop-opacity="0.25"/>
      <stop offset="100%" stop-color="#10B981" stop-opacity="0.08"/>
    </linearGradient>
    <linearGradient id="qryGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#F59E0B" stop-opacity="0.25"/>
      <stop offset="100%" stop-color="#F59E0B" stop-opacity="0.08"/>
    </linearGradient>

    <!-- Arrow markers -->
    <marker id="arrCmd" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#A78BFA"/>
    </marker>
    <marker id="arrPrj" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#34D399"/>
    </marker>
    <marker id="arrQry" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#FBBF24"/>
    </marker>
    <marker id="arrFact" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#F472B6"/>
    </marker>
    <marker id="arrMesh" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#38BDF8"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="920" fill="url(#bgGrad)"/>

  <!-- Title -->
  <text x="600" y="32" text-anchor="middle" fill="#E0E7FF" font-family="system-ui, sans-serif" font-size="22" font-weight="bold">
    The Hecate Mental Model
  </text>
  <text x="600" y="52" text-anchor="middle" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="12">
    Venture &gt; Division &gt; Department (Cartwheel) &gt; Desk (Spoke) — Event-driven data flow
  </text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- VENTURE (outermost container)                               -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <rect x="15" y="65" width="1170" height="590" rx="12" fill="url(#ventureGrad)" stroke="#6366F1" stroke-width="2"/>

  <!-- Venture label -->
  <rect x="30" y="75" width="120" height="28" rx="14" fill="#4338CA" fill-opacity="0.6"/>
  <text x="90" y="94" text-anchor="middle" fill="#E0E7FF" font-family="system-ui, sans-serif" font-size="13" font-weight="bold">
    VENTURE
  </text>
  <text x="165" y="94" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="11">
    The overall business endeavor (conglomerate of divisions)
  </text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- DIVISION 1 (bounded context within the venture)             -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <rect x="35" y="110" width="1130" height="400" rx="10" fill="url(#divisionGrad)" stroke="#818CF8" stroke-width="1.5"/>

  <!-- Division 1 label -->
  <rect x="50" y="118" width="130" height="24" rx="12" fill="#4338CA" fill-opacity="0.5"/>
  <text x="115" y="135" text-anchor="middle" fill="#C7D2FE" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">
    DIVISION 1
  </text>
  <text x="193" y="135" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="10">
    Bounded context — 3 departments cooperating (e.g. "auth")
  </text>

  <!-- ─────────────────────────────────────────────── -->
  <!-- CMD Department (Cartwheel 1 — front-office)     -->
  <!-- ─────────────────────────────────────────────── -->
  <rect x="55" y="150" width="305" height="345" rx="8" fill="url(#cmdGrad)" stroke="#8B5CF6" stroke-width="2"/>

  <!-- CMD header -->
  <text x="208" y="175" text-anchor="middle" fill="#A78BFA" font-family="system-ui, sans-serif" font-size="15" font-weight="bold">
    CMD Department
  </text>
  <text x="208" y="192" text-anchor="middle" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="10">
    Front-Office · Requests · Cartwheel 1
  </text>

  <!-- CMD Hub (dossier/aggregate) -->
  <rect x="133" y="205" width="150" height="50" rx="25" fill="#312E81" stroke="#A78BFA" stroke-width="2"/>
  <text x="208" y="226" text-anchor="middle" fill="#E0E7FF" font-family="system-ui, sans-serif" font-size="11" font-weight="bold">
    Dossier
  </text>
  <text x="208" y="242" text-anchor="middle" fill="#A5B4FC" font-family="system-ui, sans-serif" font-size="9">
    (aggregate state)
  </text>

  <!-- CMD Desks (Spokes) -->
  <rect x="72" y="270" width="125" height="50" rx="4" fill="#1E1B4B" stroke="#7C3AED" stroke-width="1"/>
  <text x="134" y="290" text-anchor="middle" fill="#C7D2FE" font-family="system-ui, sans-serif" font-size="10" font-weight="500">
    start_design
  </text>
  <text x="134" y="305" text-anchor="middle" fill="#818CF8" font-family="system-ui, sans-serif" font-size="8">
    Desk (Spoke)
  </text>

  <rect x="218" y="270" width="125" height="50" rx="4" fill="#1E1B4B" stroke="#7C3AED" stroke-width="1"/>
  <text x="280" y="290" text-anchor="middle" fill="#C7D2FE" font-family="system-ui, sans-serif" font-size="10" font-weight="500">
    design_aggregate
  </text>
  <text x="280" y="305" text-anchor="middle" fill="#818CF8" font-family="system-ui, sans-serif" font-size="8">
    Desk (Spoke)
  </text>

  <rect x="72" y="335" width="125" height="50" rx="4" fill="#1E1B4B" stroke="#7C3AED" stroke-width="1"/>
  <text x="134" y="355" text-anchor="middle" fill="#C7D2FE" font-family="system-ui, sans-serif" font-size="10" font-weight="500">
    complete_design
  </text>
  <text x="134" y="370" text-anchor="middle" fill="#818CF8" font-family="system-ui, sans-serif" font-size="8">
    Desk (Spoke)
  </text>

  <rect x="218" y="335" width="125" height="50" rx="4" fill="#1E1B4B" stroke="#7C3AED" stroke-width="1"/>
  <text x="280" y="355" text-anchor="middle" fill="#C7D2FE" font-family="system-ui, sans-serif" font-size="10" font-weight="500">
    archive_design
  </text>
  <text x="280" y="370" text-anchor="middle" fill="#818CF8" font-family="system-ui, sans-serif" font-size="8">
    Desk (Spoke)
  </text>

  <!-- Spoke lines (from hub to desks) -->
  <line x1="183" y1="255" x2="134" y2="270" stroke="#7C3AED" stroke-width="1" stroke-opacity="0.5"/>
  <line x1="233" y1="255" x2="280" y2="270" stroke="#7C3AED" stroke-width="1" stroke-opacity="0.5"/>
  <line x1="183" y1="255" x2="134" y2="335" stroke="#7C3AED" stroke-width="1" stroke-opacity="0.5"/>
  <line x1="233" y1="255" x2="280" y2="335" stroke="#7C3AED" stroke-width="1" stroke-opacity="0.5"/>

  <!-- ReckonDB cylinder (EVENT STORE — inside CMD) -->
  <g>
    <!-- Cylinder body -->
    <rect x="158" y="425" width="100" height="30" fill="#2D1B69"/>
    <!-- Left/right sides -->
    <line x1="158" y1="425" x2="158" y2="455" stroke="#A78BFA" stroke-width="1.5"/>
    <line x1="258" y1="425" x2="258" y2="455" stroke="#A78BFA" stroke-width="1.5"/>
    <!-- Bottom ellipse -->
    <ellipse cx="208" cy="455" rx="50" ry="10" fill="#2D1B69" stroke="#A78BFA" stroke-width="1.5"/>
    <!-- Top ellipse (lid — drawn last to overlay) -->
    <ellipse cx="208" cy="425" rx="50" ry="10" fill="#3B2D7C" stroke="#A78BFA" stroke-width="1.5"/>
    <!-- Label -->
    <text x="208" y="445" text-anchor="middle" fill="#DDD6FE" font-family="system-ui, sans-serif" font-size="10" font-weight="bold">
      ReckonDB
    </text>
    <text x="208" y="482" text-anchor="middle" fill="#A5B4FC" font-family="system-ui, sans-serif" font-size="8">
      event store (log)
    </text>
  </g>

  <!-- Arrow from desks down to ReckonDB -->
  <line x1="208" y1="385" x2="208" y2="415" stroke="#7C3AED" stroke-width="1.5" stroke-opacity="0.6" marker-end="url(#arrCmd)"/>

  <!-- ─────────────────────────────────────────────── -->
  <!-- PRJ Department (Cartwheel 2 — back-office)      -->
  <!-- Shifted right: x=385→400, center=530            -->
  <!-- ─────────────────────────────────────────────── -->
  <rect x="400" y="150" width="260" height="345" rx="8" fill="url(#prjGrad)" stroke="#10B981" stroke-width="2"/>

  <!-- PRJ header -->
  <text x="530" y="175" text-anchor="middle" fill="#6EE7B7" font-family="system-ui, sans-serif" font-size="15" font-weight="bold">
    PRJ Department
  </text>
  <text x="530" y="192" text-anchor="middle" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="10">
    Back-Office · Knowledge Warehouse · Cartwheel 2
  </text>

  <!-- PRJ Hub (projections) -->
  <rect x="460" y="205" width="140" height="50" rx="25" fill="#022C22" stroke="#34D399" stroke-width="2"/>
  <text x="530" y="226" text-anchor="middle" fill="#A7F3D0" font-family="system-ui, sans-serif" font-size="11" font-weight="bold">
    Projections
  </text>
  <text x="530" y="242" text-anchor="middle" fill="#6EE7B7" font-family="system-ui, sans-serif" font-size="9">
    (event subscribers)
  </text>

  <!-- PRJ Desks (projections) -->
  <rect x="413" y="270" width="234" height="50" rx="4" fill="#064E3B" stroke="#059669" stroke-width="1"/>
  <text x="530" y="290" text-anchor="middle" fill="#A7F3D0" font-family="system-ui, sans-serif" font-size="10" font-weight="500">
    aggregate_designed_v1 to designs
  </text>
  <text x="530" y="305" text-anchor="middle" fill="#34D399" font-family="system-ui, sans-serif" font-size="8">
    Projection Desk (Spoke)
  </text>

  <rect x="413" y="335" width="234" height="50" rx="4" fill="#064E3B" stroke="#059669" stroke-width="1"/>
  <text x="530" y="355" text-anchor="middle" fill="#A7F3D0" font-family="system-ui, sans-serif" font-size="10" font-weight="500">
    design_completed_v1 to designs
  </text>
  <text x="530" y="370" text-anchor="middle" fill="#34D399" font-family="system-ui, sans-serif" font-size="8">
    Projection Desk (Spoke)
  </text>

  <!-- PRJ subscribes to events label -->
  <rect x="413" y="400" width="234" height="30" rx="4" fill="#065F46" fill-opacity="0.5" stroke="#34D399" stroke-width="1" stroke-dasharray="4,2"/>
  <text x="530" y="420" text-anchor="middle" fill="#A7F3D0" font-family="system-ui, sans-serif" font-size="10">
    subscribes to Events, writes to SQLite
  </text>

  <!-- Spoke lines (from hub to desks) -->
  <line x1="530" y1="255" x2="530" y2="270" stroke="#059669" stroke-width="1" stroke-opacity="0.5"/>
  <line x1="530" y1="255" x2="530" y2="335" stroke="#059669" stroke-width="1" stroke-opacity="0.5"/>

  <!-- ─────────────────────────────────────────────── -->
  <!-- SQLite CYLINDER (centered between PRJ and QRY)  -->
  <!-- PRJ right: 660, QRY left: 830, midpoint: 745   -->
  <!-- ─────────────────────────────────────────────── -->
  <g>
    <!-- Cylinder body -->
    <rect x="710" y="265" width="70" height="50" fill="#1E293B"/>
    <!-- Left/right sides -->
    <line x1="710" y1="265" x2="710" y2="315" stroke="#94A3B8" stroke-width="1.5"/>
    <line x1="780" y1="265" x2="780" y2="315" stroke="#94A3B8" stroke-width="1.5"/>
    <!-- Bottom ellipse -->
    <ellipse cx="745" cy="315" rx="35" ry="8" fill="#1E293B" stroke="#94A3B8" stroke-width="1.5"/>
    <!-- Top ellipse (lid) -->
    <ellipse cx="745" cy="265" rx="35" ry="8" fill="#334155" stroke="#94A3B8" stroke-width="1.5"/>
    <!-- Labels -->
    <text x="745" y="286" text-anchor="middle" fill="#E2E8F0" font-family="system-ui, sans-serif" font-size="11" font-weight="bold">
      SQLite
    </text>
    <text x="745" y="302" text-anchor="middle" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="8">
      (read model)
    </text>
  </g>

  <!-- ─────────────────────────────────────────────── -->
  <!-- QRY Department (Cartwheel 3 — front-office)     -->
  <!-- Shifted left: x=855→830, center=980             -->
  <!-- ─────────────────────────────────────────────── -->
  <rect x="830" y="150" width="300" height="345" rx="8" fill="url(#qryGrad)" stroke="#F59E0B" stroke-width="2"/>

  <!-- QRY header -->
  <text x="980" y="175" text-anchor="middle" fill="#FCD34D" font-family="system-ui, sans-serif" font-size="15" font-weight="bold">
    QRY Department
  </text>
  <text x="980" y="192" text-anchor="middle" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="10">
    Front-Office · Inquiries · Cartwheel 3
  </text>

  <!-- QRY Hub (query service) -->
  <rect x="905" y="205" width="150" height="50" rx="25" fill="#451A03" stroke="#FBBF24" stroke-width="2"/>
  <text x="980" y="226" text-anchor="middle" fill="#FDE68A" font-family="system-ui, sans-serif" font-size="11" font-weight="bold">
    API Gateway
  </text>
  <text x="980" y="242" text-anchor="middle" fill="#FCD34D" font-family="system-ui, sans-serif" font-size="9">
    (serves queries)
  </text>

  <!-- QRY Desks (query endpoints) -->
  <rect x="843" y="270" width="260" height="50" rx="4" fill="#78350F" stroke="#D97706" stroke-width="1"/>
  <text x="973" y="290" text-anchor="middle" fill="#FDE68A" font-family="system-ui, sans-serif" font-size="10" font-weight="500">
    get_design_by_id
  </text>
  <text x="973" y="305" text-anchor="middle" fill="#FBBF24" font-family="system-ui, sans-serif" font-size="8">
    Query Desk (Spoke) — GET /designs/:id
  </text>

  <rect x="843" y="335" width="260" height="50" rx="4" fill="#78350F" stroke="#D97706" stroke-width="1"/>
  <text x="973" y="355" text-anchor="middle" fill="#FDE68A" font-family="system-ui, sans-serif" font-size="10" font-weight="500">
    get_designs_page
  </text>
  <text x="973" y="370" text-anchor="middle" fill="#FBBF24" font-family="system-ui, sans-serif" font-size="8">
    Query Desk (Spoke) — GET /designs?page=N
  </text>

  <!-- QRY reads from SQLite label -->
  <rect x="870" y="400" width="220" height="30" rx="4" fill="#78350F" fill-opacity="0.5" stroke="#FBBF24" stroke-width="1" stroke-dasharray="4,2"/>
  <text x="980" y="420" text-anchor="middle" fill="#FDE68A" font-family="system-ui, sans-serif" font-size="10">
    reads from SQLite (fast queries)
  </text>

  <!-- Spoke lines (from hub to desks) -->
  <line x1="980" y1="255" x2="973" y2="270" stroke="#D97706" stroke-width="1" stroke-opacity="0.5"/>
  <line x1="980" y1="255" x2="973" y2="335" stroke="#D97706" stroke-width="1" stroke-opacity="0.5"/>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- DATA FLOW ARROWS (between departments)                      -->
  <!-- ═══════════════════════════════════════════════════════════ -->

  <!-- 1. CMD ReckonDB → PRJ (Event subscription flow) -->
  <path id="eventPath" d="M 258,440 L 400,440" stroke="#A78BFA" stroke-width="2" fill="none" marker-end="url(#arrPrj)"/>
  <text x="329" y="433" text-anchor="middle" fill="#C4B5FD" font-family="system-ui, sans-serif" font-size="8">
    subscription
  </text>

  <!-- Animated event dots: ReckonDB to PRJ (SMIL) -->
  <circle r="4" fill="#A78BFA">
    <animateMotion dur="2s" repeatCount="indefinite" begin="0s">
      <mpath href="#eventPath"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="2s" repeatCount="indefinite" begin="0s"/>
  </circle>
  <circle r="4" fill="#A78BFA">
    <animateMotion dur="2s" repeatCount="indefinite" begin="1s">
      <mpath href="#eventPath"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="2s" repeatCount="indefinite" begin="1s"/>
  </circle>

  <!-- 2. PRJ → SQLite (Write flow) -->
  <path id="writePath" d="M 660,295 L 710,295" stroke="#34D399" stroke-width="2" fill="none" marker-end="url(#arrPrj)"/>
  <text x="685" y="248" text-anchor="middle" fill="#6EE7B7" font-family="system-ui, sans-serif" font-size="8">
    writes
  </text>

  <!-- Animated write dots: PRJ to SQLite (SMIL) -->
  <circle r="3" fill="#34D399">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.5s">
      <mpath href="#writePath"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="1.5s" repeatCount="indefinite" begin="0.5s"/>
  </circle>

  <!-- 3. SQLite → QRY (Read flow) -->
  <path id="readPath" d="M 780,295 L 830,295" stroke="#FBBF24" stroke-width="2" fill="none" stroke-dasharray="6,3" marker-end="url(#arrQry)"/>
  <text x="805" y="248" text-anchor="middle" fill="#FCD34D" font-family="system-ui, sans-serif" font-size="8">
    reads
  </text>

  <!-- Animated read dot: SQLite to QRY (SMIL) -->
  <circle r="3" fill="#FBBF24">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.8s">
      <mpath href="#readPath"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="1.5s" repeatCount="indefinite" begin="0.8s"/>
  </circle>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- FACT TRANSPORT (centered under CMD department)              -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <rect x="113" y="535" width="190" height="100" rx="8" fill="#1E1B4B" stroke="#F472B6" stroke-width="1.5"/>
  <text x="208" y="560" text-anchor="middle" fill="#F9A8D4" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">
    Fact Transport
  </text>
  <text x="208" y="578" text-anchor="middle" fill="#F472B6" font-family="system-ui, sans-serif" font-size="10">
    pg groups (internal)
  </text>
  <text x="208" y="596" text-anchor="middle" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="9">
    Same BEAM VM
  </text>
  <text x="208" y="612" text-anchor="middle" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="9">
    Division-to-Division
  </text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- DIVISION 2 (solid border, matching Division 1 style)        -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <rect x="400" y="535" width="720" height="100" rx="10" fill="url(#divisionGrad)" stroke="#818CF8" stroke-width="1.5"/>

  <rect x="415" y="543" width="130" height="24" rx="12" fill="#4338CA" fill-opacity="0.5"/>
  <text x="480" y="560" text-anchor="middle" fill="#C7D2FE" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">
    DIVISION 2
  </text>
  <text x="558" y="560" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="10">
    Another bounded context (e.g. "billing")
  </text>

  <!-- Mini departments -->
  <rect x="420" y="575" width="200" height="45" rx="4" fill="url(#cmdGrad)" stroke="#8B5CF6" stroke-width="1" stroke-opacity="0.6"/>
  <text x="520" y="602" text-anchor="middle" fill="#A78BFA" font-family="system-ui, sans-serif" font-size="10">CMD (desks...)</text>
  <rect x="640" y="575" width="200" height="45" rx="4" fill="url(#prjGrad)" stroke="#10B981" stroke-width="1" stroke-opacity="0.6"/>
  <text x="740" y="602" text-anchor="middle" fill="#6EE7B7" font-family="system-ui, sans-serif" font-size="10">PRJ (desks...)</text>
  <rect x="860" y="575" width="200" height="45" rx="4" fill="url(#qryGrad)" stroke="#F59E0B" stroke-width="1" stroke-opacity="0.6"/>
  <text x="960" y="602" text-anchor="middle" fill="#FCD34D" font-family="system-ui, sans-serif" font-size="10">QRY (desks...)</text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- FACT FLOW: Division 1 ↔ Fact Transport (emit / listen)     -->
  <!-- ═══════════════════════════════════════════════════════════ -->

  <!-- Division 1 → Fact Transport (emit ↓) -->
  <path id="factEmitDown" d="M 196,510 L 196,535" stroke="#F472B6" stroke-width="1.5" fill="none" stroke-dasharray="5,3" marker-end="url(#arrFact)"/>
  <text x="178" y="526" text-anchor="end" fill="#F9A8D4" font-family="system-ui, sans-serif" font-size="8">emit</text>

  <!-- Fact Transport → Division 1 (listen ↑) -->
  <path id="factListenUp" d="M 220,535 L 220,510" stroke="#F472B6" stroke-width="1.5" fill="none" stroke-dasharray="5,3" marker-end="url(#arrFact)"/>
  <text x="238" y="526" fill="#F9A8D4" font-family="system-ui, sans-serif" font-size="8">listen</text>

  <!-- Animated dots: Div1 ↔ FT vertical -->
  <circle r="3" fill="#F472B6">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0s">
      <mpath href="#factEmitDown"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="1.5s" repeatCount="indefinite" begin="0s"/>
  </circle>
  <circle r="3" fill="#F472B6">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.4s">
      <mpath href="#factListenUp"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="1.5s" repeatCount="indefinite" begin="0.4s"/>
  </circle>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- FACT FLOW: Fact Transport ↔ Division 2 (emit / listen)     -->
  <!-- ═══════════════════════════════════════════════════════════ -->

  <!-- Fact Transport → Division 2 (listen →) -->
  <path id="factEmitRight" d="M 303,575 L 400,575" stroke="#F472B6" stroke-width="1.5" fill="none" stroke-dasharray="5,3" marker-end="url(#arrFact)"/>
  <text x="352" y="568" text-anchor="middle" fill="#F9A8D4" font-family="system-ui, sans-serif" font-size="8">listen</text>

  <!-- Division 2 → Fact Transport (emit ←) -->
  <path id="factListenLeft" d="M 400,595 L 303,595" stroke="#F472B6" stroke-width="1.5" fill="none" stroke-dasharray="5,3" marker-end="url(#arrFact)"/>
  <text x="352" y="610" text-anchor="middle" fill="#F9A8D4" font-family="system-ui, sans-serif" font-size="8">emit</text>

  <!-- Animated dots: FT ↔ Div2 horizontal -->
  <circle r="3" fill="#F472B6">
    <animateMotion dur="2s" repeatCount="indefinite" begin="0.2s">
      <mpath href="#factEmitRight"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="2s" repeatCount="indefinite" begin="0.2s"/>
  </circle>
  <circle r="3" fill="#F472B6">
    <animateMotion dur="2s" repeatCount="indefinite" begin="0.8s">
      <mpath href="#factListenLeft"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="2s" repeatCount="indefinite" begin="0.8s"/>
  </circle>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- MACULA MESH (external fact transport — taller)              -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <rect x="35" y="690" width="1130" height="145" rx="10" fill="#0C4A6E" fill-opacity="0.3" stroke="#38BDF8" stroke-width="2"/>

  <!-- Mesh label -->
  <rect x="50" y="698" width="130" height="24" rx="12" fill="#0369A1" fill-opacity="0.7"/>
  <text x="115" y="715" text-anchor="middle" fill="#BAE6FD" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">
    MACULA MESH
  </text>
  <text x="195" y="715" fill="#7DD3FC" font-family="system-ui, sans-serif" font-size="10">
    External fact transport — HTTP/3 over QUIC, DHT PubSub
  </text>

  <!-- Beam Cluster group border (subtle dashed) -->
  <rect x="62" y="735" width="420" height="85" rx="8" fill="none" stroke="#0EA5E9" stroke-width="1" stroke-dasharray="6,3" stroke-opacity="0.4"/>
  <text x="272" y="731" text-anchor="middle" fill="#7DD3FC" font-family="system-ui, sans-serif" font-size="9" fill-opacity="0.6">beam cluster</text>

  <!-- Agent A (beam00) — cluster node -->
  <rect x="75" y="748" width="185" height="55" rx="6" fill="#0C4A6E" stroke="#0EA5E9" stroke-width="1"/>
  <text x="168" y="770" text-anchor="middle" fill="#BAE6FD" font-family="system-ui, sans-serif" font-size="11" font-weight="500">
    Agent A (beam00)
  </text>
  <text x="168" y="788" text-anchor="middle" fill="#7DD3FC" font-family="system-ui, sans-serif" font-size="9">
    Publishes facts to mesh
  </text>

  <!-- Pulse ring around Agent A -->
  <circle cx="168" cy="775" r="14" fill="none" stroke="#0EA5E9">
    <animate attributeName="r" values="14;40;55" dur="3s" repeatCount="indefinite"/>
    <animate attributeName="opacity" values="0.6;0.2;0" dur="3s" repeatCount="indefinite"/>
  </circle>

  <!-- Agent B (beam01) — cluster node, closer to A -->
  <rect x="282" y="748" width="185" height="55" rx="6" fill="#0C4A6E" stroke="#0EA5E9" stroke-width="1"/>
  <text x="375" y="770" text-anchor="middle" fill="#BAE6FD" font-family="system-ui, sans-serif" font-size="11" font-weight="500">
    Agent B (beam01)
  </text>
  <text x="375" y="788" text-anchor="middle" fill="#7DD3FC" font-family="system-ui, sans-serif" font-size="9">
    Subscribes to mesh topics
  </text>

  <!-- Edge nodes group border (subtle dashed, warm) -->
  <rect x="577" y="735" width="420" height="85" rx="8" fill="none" stroke="#D97706" stroke-width="1" stroke-dasharray="6,3" stroke-opacity="0.4"/>
  <text x="787" y="731" text-anchor="middle" fill="#FBBF24" font-family="system-ui, sans-serif" font-size="9" fill-opacity="0.6">edge nodes</text>

  <!-- Agent C (edge) — warm amber color -->
  <rect x="590" y="748" width="185" height="55" rx="6" fill="#451A03" stroke="#D97706" stroke-width="1"/>
  <text x="683" y="770" text-anchor="middle" fill="#FDE68A" font-family="system-ui, sans-serif" font-size="11" font-weight="500">
    Agent C (edge)
  </text>
  <text x="683" y="788" text-anchor="middle" fill="#FBBF24" font-family="system-ui, sans-serif" font-size="9">
    Discovers peers via DHT
  </text>

  <!-- Agent D (mobile) — warm amber color -->
  <rect x="800" y="748" width="185" height="55" rx="6" fill="#451A03" stroke="#D97706" stroke-width="1"/>
  <text x="893" y="770" text-anchor="middle" fill="#FDE68A" font-family="system-ui, sans-serif" font-size="11" font-weight="500">
    Agent D (mobile)
  </text>
  <text x="893" y="788" text-anchor="middle" fill="#FBBF24" font-family="system-ui, sans-serif" font-size="9">
    Mesh participant
  </text>

  <!-- Animated mesh packets: Cluster → C -->
  <path id="meshPathClusterC" d="M 467,775 L 590,775" fill="none" stroke="none"/>
  <line x1="467" y1="775" x2="590" y2="775" stroke="#0EA5E9" stroke-width="1" stroke-dasharray="4,3" stroke-opacity="0.4"/>
  <circle r="4" fill="#38BDF8">
    <animateMotion dur="2s" repeatCount="indefinite" begin="0s">
      <mpath href="#meshPathClusterC"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="2s" repeatCount="indefinite" begin="0s"/>
  </circle>
  <circle r="4" fill="#38BDF8">
    <animateMotion dur="2s" repeatCount="indefinite" begin="0.6s">
      <mpath href="#meshPathClusterC"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="2s" repeatCount="indefinite" begin="0.6s"/>
  </circle>

  <!-- Animated mesh packets: C → D -->
  <path id="meshPathCD" d="M 775,775 L 800,775" fill="none" stroke="none"/>
  <line x1="775" y1="775" x2="800" y2="775" stroke="#D97706" stroke-width="1" stroke-dasharray="4,3" stroke-opacity="0.4"/>
  <circle r="4" fill="#FBBF24">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.3s">
      <mpath href="#meshPathCD"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="1.5s" repeatCount="indefinite" begin="0.3s"/>
  </circle>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- FACT FLOW: Fact Transport ↔ Mesh (publish / subscribe)     -->
  <!-- ═══════════════════════════════════════════════════════════ -->

  <!-- Fact Transport → Mesh (publish ↓) -->
  <path id="factPublishDown" d="M 196,635 L 196,690" stroke="#38BDF8" stroke-width="1.5" fill="none" marker-end="url(#arrMesh)"/>
  <text x="178" y="666" text-anchor="end" fill="#7DD3FC" font-family="system-ui, sans-serif" font-size="8">publish</text>

  <!-- Mesh → Fact Transport (subscribe ↑) -->
  <path id="factSubscribeUp" d="M 220,690 L 220,635" stroke="#38BDF8" stroke-width="1.5" fill="none" stroke-dasharray="5,3" marker-end="url(#arrMesh)"/>
  <text x="238" y="666" fill="#7DD3FC" font-family="system-ui, sans-serif" font-size="8">subscribe</text>

  <!-- Animated dots: FT ↔ Mesh vertical -->
  <circle r="3" fill="#38BDF8">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.3s">
      <mpath href="#factPublishDown"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="1.5s" repeatCount="indefinite" begin="0.3s"/>
  </circle>
  <circle r="3" fill="#38BDF8">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.9s">
      <mpath href="#factSubscribeUp"/>
    </animateMotion>
    <animate attributeName="opacity" values="0;1;1;0" dur="1.5s" repeatCount="indefinite" begin="0.9s"/>
  </circle>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!-- LEGEND                                                      -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <rect x="15" y="855" width="1170" height="35" rx="6" fill="#1E293B"/>

  <!-- Legend items -->
  <circle cx="40" cy="872" r="5" fill="#8B5CF6"/>
  <text x="50" y="876" fill="#A5B4FC" font-family="system-ui, sans-serif" font-size="9">CMD = Requests</text>

  <circle cx="160" cy="872" r="5" fill="#10B981"/>
  <text x="170" y="876" fill="#6EE7B7" font-family="system-ui, sans-serif" font-size="9">PRJ = Projections</text>

  <circle cx="295" cy="872" r="5" fill="#F59E0B"/>
  <text x="305" y="876" fill="#FCD34D" font-family="system-ui, sans-serif" font-size="9">QRY = Queries</text>

  <circle cx="405" cy="872" r="5" fill="#F472B6"/>
  <text x="415" y="876" fill="#F9A8D4" font-family="system-ui, sans-serif" font-size="9">Facts (pg groups)</text>

  <circle cx="535" cy="872" r="5" fill="#38BDF8"/>
  <text x="545" y="876" fill="#7DD3FC" font-family="system-ui, sans-serif" font-size="9">Mesh (QUIC)</text>

  <!-- ReckonDB legend -->
  <rect x="640" y="866" width="16" height="12" rx="2" fill="#2D1B69" stroke="#A78BFA" stroke-width="1"/>
  <text x="662" y="876" fill="#DDD6FE" font-family="system-ui, sans-serif" font-size="9">ReckonDB (events)</text>

  <!-- SQLite legend -->
  <rect x="785" y="866" width="16" height="12" rx="2" fill="#1E293B" stroke="#94A3B8" stroke-width="1"/>
  <text x="807" y="876" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="9">SQLite (read model)</text>

  <line x1="930" y1="872" x2="955" y2="872" stroke="#94A3B8" stroke-width="1.5" stroke-dasharray="4,2"/>
  <text x="963" y="876" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="9">= read-only flow</text>

  <circle cx="1070" cy="872" r="4" fill="#A78BFA">
    <animate attributeName="opacity" values="0.3;1;0.3" dur="2s" repeatCount="indefinite"/>
  </circle>
  <text x="1080" y="876" fill="#94A3B8" font-family="system-ui, sans-serif" font-size="9">= animated</text>
</svg>
